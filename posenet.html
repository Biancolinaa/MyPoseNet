%%html
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
<pre id="output"></pre>
<!-- <img id="image" src="https://storage.googleapis.com/tfjs-models/assets/posenet/skiing.jpg" /> -->
<script>
  const output = document.getElementById('output');

  output.textContent = 'Ciao!'

  function loadImage() {
    const image = new Image();
    const promise = new Promise((resolve, reject) => {
      image.crossOrigin = '';
      image.onload = () => {
        resolve(image);
      };
    });

    image.src = "https://storage.googleapis.com/tfjs-models/assets/posenet/skiing.jpg";
    return promise;
  }

  let _net = null;
  
  output.textContent = 'Loading...';
  posenet.load()
    .then((net) => {
      output.textContent = 'Net loaded - loading image...';
      _net = net;
      return loadImage();
    })
    .then((image) => {
      const input = tf.browser.fromPixels(image);
      output.textContent = 'Image ok, estimating...';
      return _net.estimatePoses(input, {
        flipHorizontal: false,
        decodingMethod: 'single-person',
        maxDetections: 1,
        scoreThreshold: 0.1,
        nmsRadius: 20.0,
      });
    }).then((result) => {
      output.textContent = JSON.stringify(result)
    });